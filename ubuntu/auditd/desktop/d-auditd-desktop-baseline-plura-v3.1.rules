# PLURA_CONFIG_VERSION: auditd-desktop-baseline-plura-v3.1.rules
# PLURA_SCHEMA_TARGET: v3.1
# Profile: DESKTOP-BASELINE (Ubuntu Desktop, low-noise)
# Notes:
# - Removed high-volume directory execute watches (/run, /var/run, /var/lock, /dev/shm).
# - Keep legacy qubit-* keys where reasonable, and add plura_* keys for coverage.
# - Avoid watching paths that may not exist by default (kept as optional/commented).
# Ubuntu adaptation:
# - Replace SELinux path watch with AppArmor paths (keep key qubit-selinux for backward compatibility).
# - Replace systemd unit dir /usr/lib/systemd/system with /lib/systemd/system (Ubuntu default).
# - Replace /etc/bashrc with /etc/bash.bashrc.
# - Replace RHEL iptables config path (/etc/sysconfig/iptables) with Ubuntu firewall options (UFW / nftables / iptables-persistent) as optional.
# Desktop adaptation:
# - Comment out watches for binaries not installed by default on Ubuntu Desktop (gcc/ncat/vnc/rsync/scp/sftp).
# - Comment out /etc/ssh/sshd_config watch (openssh-server not installed by default).
# - Replace /etc/resolv.conf watch (noisy on DHCP/Wi-Fi) with systemd-resolved config watches.
# Generated: 2026-01-03

############################################################
# 1) Legacy (qubit-*) - trimmed for noise
############################################################

# Identity files (high signal)
-w /etc/shadow -p wa -k qubit-shadow
-w /etc/passwd -p wa -k qubit-passwd

# Privilege/permission tooling (moderate signal)
-w /usr/bin/chown -p x -k qubit-chown
-w /usr/bin/chmod -p x -k qubit-perm

# Compiler execution
# (Desktop optional) -w /usr/bin/gcc -p x -k qubit-gcc

# Recon / account tooling
-w /usr/bin/whoami -p x -k qubit-recon
-w /usr/bin/w -p x -k qubit-recon
-w /usr/sbin/useradd -p x -k qubit-useradd
-w /usr/sbin/userdel -p x -k qubit-userdel

# Network / transfer tools
# (Desktop optional) -w /usr/bin/ncat -p x -k qubit-nc
# (Desktop optional) -w /usr/bin/nc -p x -k qubit-nc
-w /usr/bin/curl -p x -k qubit-curl
-w /usr/bin/wget -p x -k qubit-wget

# Utility / core config
-w /usr/bin/base64 -p x -k qubit-base64
-w /etc/sysctl.conf -p wa -k qubit-kernel
# Ubuntu: AppArmor config (replaces /etc/selinux) - keep legacy key for compatibility
-w /etc/apparmor -p wa -k qubit-selinux
-w /etc/apparmor.d -p wa -k qubit-selinux
# Optional (enable if present)
# -w /etc/default/apparmor -p wa -k qubit-selinux
-w /etc/hosts -p wa -k qubit-host
-w /etc/localtime -p wa -k qubit-time

# Remote access (as-is)
# (Desktop optional) -w /usr/bin/vncserver -p x -k qubit-vnc
# (Desktop optional) -w /usr/bin/x11vnc -p x -k qubit-vnc
# (Desktop optional) -w /usr/bin/Xvnc -p x -k qubit-vnc
# (Desktop optional) -w /usr/bin/sftp -p x -k qubit-sftp
# (Desktop optional) -w /usr/bin/rsync -p x -k qubit-rsync
# (Desktop optional) -w /usr/bin/scp -p x -k qubit-scp

# IMPORTANT: Removed (high-volume) directory execute watches from v3.0:
# -w /run -p x -k qubit-dir-/run
# -w /var/run -p x -k qubit-dir-/var/run
# -w /var/lock -p x -k qubit-dir-/var/lock
# -w /dev/shm -p x -k qubit-dir-/dev/shm
#
# Removed (often high-frequency in ops environments):
# -w /usr/bin/rm -p x -k qubit-rm
# -w /usr/bin/cp -p x -k qubit-cp

# Socket syscall (AF_PACKET=17) - add auid filter to reduce daemon noise
-a always,exit -F arch=b64 -S socket -F a0=17 -F auid!=unset -k qubit-socket-17
-a always,exit -F arch=b32 -S socket -F a0=17 -F auid!=unset -k qubit-socket-17

# Firewall (Ubuntu)
# iptables binaries (may be nft-backed depending on system alternatives)
-w /usr/sbin/iptables -p x -k qubit-iptables
-w /sbin/iptables -p x -k qubit-iptables
# Optional (enable if present)
# -w /usr/sbin/ip6tables -p x -k qubit-iptables
# -w /sbin/ip6tables -p x -k qubit-iptables
# -w /usr/sbin/nft -p x -k qubit-iptables
# -w /etc/nftables.conf -p wa -k qubit-iptables
# Ubuntu default firewall (UFW)
# -w /usr/sbin/ufw -p x -k qubit-iptables
# -w /etc/ufw -p wa -k qubit-iptables
# -w /etc/default/ufw -p wa -k qubit-iptables
# iptables-persistent (if used)
# -w /etc/iptables -p wa -k qubit-iptables
# -w /etc/iptables/rules.v4 -p wa -k qubit-iptables
# -w /etc/iptables/rules.v6 -p wa -k qubit-iptables


############################################################
# 2) PLURA baseline coverage (plura_*)
############################################################

# Identity / auth db (add missing group/gshadow)
-w /etc/group -p wa -k plura_identity
-w /etc/gshadow -p wa -k plura_identity

# User/group management commands
-w /usr/sbin/usermod -p x -k plura_user_mgmt
-w /usr/sbin/groupadd -p x -k plura_group_mgmt
-w /usr/sbin/groupdel -p x -k plura_group_mgmt
-w /usr/sbin/groupmod -p x -k plura_group_mgmt

# Password/account attribute changes
-w /usr/bin/passwd -p x -k plura_passwd_change
-w /usr/bin/chage -p x -k plura_passwd_change
-w /usr/sbin/chpasswd -p x -k plura_passwd_change

# Privilege escalation & sudo config
-w /bin/su -p x -k plura_priv_exec
-w /usr/bin/sudo -p x -k plura_priv_exec
-w /usr/bin/sudoedit -p x -k plura_priv_exec
-w /etc/sudoers -p wa -k plura_sudo_config
-w /etc/sudoers.d -p wa -k plura_sudo_config

# SSH config changes (desktop focus)
# (Optional: enable if openssh-server is installed)
# -w /etc/ssh/sshd_config -p wa -k plura_ssh_config
# -w /etc/ssh/sshd_config.d -p wa -k plura_ssh_config
-w /etc/ssh -p wa -k plura_ssh_config

# Persistence - systemd and init scripts
-w /etc/systemd/system -p wa -k plura_systemd
-w /lib/systemd/system -p wa -k plura_systemd
# Optional (enable if present / usr-merge environments)
# -w /usr/lib/systemd/system -p wa -k plura_systemd
-w /etc/init.d -p wa -k plura_init

# Persistence - cron/anacron
-w /etc/crontab -p wa -k plura_cron
-w /etc/cron.d -p wa -k plura_cron
-w /etc/cron.hourly -p wa -k plura_cron
-w /etc/cron.daily -p wa -k plura_cron
-w /etc/cron.weekly -p wa -k plura_cron
-w /etc/cron.monthly -p wa -k plura_cron
# Debian/Ubuntu cron spool location
-w /var/spool/cron/crontabs -p wa -k plura_cron
# -w /var/spool/cron -p wa -k plura_cron
-w /etc/anacrontab -p wa -k plura_cron

# Auditd tampering (Defense Evasion)
-w /etc/audit -p wa -k plura_audit_config
-w /etc/audit/rules.d -p wa -k plura_audit_config
-w /etc/audit/auditd.conf -p wa -k plura_audit_config
-w /usr/sbin/auditctl -p x -k plura_audit_tools
-w /usr/sbin/augenrules -p x -k plura_audit_tools
-w /usr/sbin/auditd -p x -k plura_audit_tools

# PAM/auth configuration tampering
-w /etc/pam.d -p wa -k plura_auth_config
-w /etc/security -p wa -k plura_auth_config
-w /etc/login.defs -p wa -k plura_auth_config

# Loader / library path hijacking (ld.so.preload is often absent -> optional)
-w /etc/ld.so.conf -p wa -k plura_loader
-w /etc/ld.so.conf.d -p wa -k plura_loader
# -w /etc/ld.so.preload -p wa -k plura_loader   # enable only if file exists

# Shell/profile persistence
-w /etc/profile -p wa -k plura_shell_profile
-w /etc/profile.d -p wa -k plura_shell_profile
-w /etc/bash.bashrc -p wa -k plura_shell_profile
# Optional (for distros that use /etc/bashrc)
# -w /etc/bashrc -p wa -k plura_shell_profile

# Logging pipeline tampering
-w /etc/rsyslog.conf -p wa -k plura_logging
-w /etc/rsyslog.d -p wa -k plura_logging
-w /etc/logrotate.conf -p wa -k plura_logging
-w /etc/logrotate.d -p wa -k plura_logging

# DNS/network basics (usually exist)
# (Desktop note) # -w /etc/resolv.conf -p wa -k plura_net_conf   # noisy on laptops (DHCP/Wi-Fi); use resolved.conf watches below
-w /etc/hostname -p wa -k plura_net_conf


############################################################
# 3) Ubuntu Desktop / Workstation additions (plura_desktop_*)
############################################################

# Display manager / login (GNOME/GDM3 default on Ubuntu Desktop)
-w /etc/gdm3 -p wa -k plura_desktop_gdm

# PolicyKit / pkexec (local privilege escalation paths)
-w /etc/polkit-1 -p wa -k plura_desktop_polkit
-w /etc/polkit-1/rules.d -p wa -k plura_desktop_polkit
-w /usr/share/polkit-1/actions -p wa -k plura_desktop_polkit
-w /usr/bin/pkexec -p x -k plura_desktop_pkexec

# GNOME / dconf system database (system-wide hardening / policy)
-w /etc/dconf -p wa -k plura_desktop_dconf
-w /etc/dconf/db -p wa -k plura_desktop_dconf
-w /etc/dconf/profile -p wa -k plura_desktop_dconf

# XDG autostart (system-wide persistence)
-w /etc/xdg/autostart -p wa -k plura_desktop_autostart
-w /usr/share/xdg/autostart -p wa -k plura_desktop_autostart

# X11 / display configuration (rare but high impact)
-w /etc/X11 -p wa -k plura_desktop_x11

# Network configuration (Desktop: Wi-Fi/VPN profiles are high value)
-w /etc/NetworkManager -p wa -k plura_desktop_nm
-w /etc/NetworkManager/system-connections -p wa -k plura_desktop_nm
-w /usr/bin/nmcli -p x -k plura_desktop_nm

# Netplan (Ubuntu default network renderer config)
-w /etc/netplan -p wa -k plura_desktop_netplan

# Firewall (UFW) - enable if ufw is installed
# -w /usr/sbin/ufw -p x -k plura_desktop_fw
# -w /etc/ufw -p wa -k plura_desktop_fw
# -w /etc/default/ufw -p wa -k plura_desktop_fw

# Device rules (USB / HID / persistence)
-w /etc/udev -p wa -k plura_desktop_udev
-w /etc/udev/rules.d -p wa -k plura_desktop_udev

# Mount persistence
-w /etc/fstab -p wa -k plura_desktop_mount
# -w /etc/crypttab -p wa -k plura_desktop_mount   # enable only if file exists

# Package repository sources (supply-chain / repo hijack)
-w /etc/apt/sources.list -p wa -k plura_pkg_sources
-w /etc/apt/sources.list.d -p wa -k plura_pkg_sources
-w /etc/apt/apt.conf.d -p wa -k plura_pkg_sources

# Certificate trust store (MITM / malicious root CA)
-w /etc/ca-certificates.conf -p wa -k plura_trust_store
-w /usr/local/share/ca-certificates -p wa -k plura_trust_store

# Snap (Ubuntu Desktop default) - command execution / config
-w /usr/bin/snap -p x -k plura_desktop_snap
-w /etc/snapd -p wa -k plura_desktop_snap

# systemd-resolved config (preferred over watching /etc/resolv.conf itself)
-w /etc/systemd/resolved.conf -p wa -k plura_net_conf
-w /etc/systemd/resolved.conf.d -p wa -k plura_net_conf
# Optional (if you still want it):
# -w /etc/resolv.conf -p wa -k plura_net_conf

# Optional: alternative display managers (uncomment if used)
# -w /etc/lightdm -p wa -k plura_desktop_dm
# -w /etc/sddm.conf -p wa -k plura_desktop_dm

# High-signal syscall rules (rare events)
# Kernel module load/unload by authenticated session (avoid daemon noise)
-a always,exit -F arch=b64 -S init_module -S delete_module -F euid=0 -F auid!=unset -k plura_kernel_module
-a always,exit -F arch=b32 -S init_module -S delete_module -F euid=0 -F auid!=unset -k plura_kernel_module
# Optional if supported
# -a always,exit -F arch=b64 -S finit_module -F euid=0 -F auid!=unset -k plura_kernel_module
# -a always,exit -F arch=b32 -S finit_module -F euid=0 -F auid!=unset -k plura_kernel_module

# System time changes (rare / high-signal)
-a always,exit -F arch=b64 -S adjtimex -S settimeofday -S clock_settime -F euid=0 -F auid!=unset -k plura_time_change
-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S clock_settime -F euid=0 -F auid!=unset -k plura_time_change
