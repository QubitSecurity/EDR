# Desktop Registry auditing rules (Registry1) - aligned with Server ruleset (SYSTEM-safe)
# Target script: win-registry.ps1  (Apply SACL to "This key only")
#
# Rule format: id|path|perm|note
# - perm: RegistryRights (comma-separated), e.g. SetValue,Delete
#
# NOTE (IMPORTANT):
# - PLURA agent runs as SYSTEM.
# - HKCU rules apply ONLY to the account running the script (SYSTEM's HKCU), and do NOT cover real users.
# - Therefore, this Desktop Registry1 ruleset is HKLM-focused (system-wide), same principle as the Server ruleset.
# - Optional HKCU rules are provided below as comments (enable only when running in user context).

# --- Run / Startup persistence (HKLM) ---
reg_run_hklm|HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run|SetValue,Delete|Run (HKLM)
reg_runonce_hklm|HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce|SetValue,Delete|RunOnce (HKLM)
reg_run_wow6432|HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Run|SetValue,Delete|Run WOW6432 (HKLM)

# StartupApproved / Policies Explorer Run (HKLM)
reg_startupapproved_hklm|HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run|SetValue,Delete|StartupApproved Run (HKLM)
reg_policy_explorer_run_hklm|HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run|SetValue,Delete|Policies Explorer Run (HKLM)

# --- Winlogon / Windows (HKLM) ---
reg_winlogon_hklm|HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon|SetValue|Winlogon (HKLM)
reg_winlogon_wow6432|HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Winlogon|SetValue|Winlogon WOW6432 (HKLM)
reg_windows_hklm|HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows|SetValue|Windows key (HKLM)

# --- UAC bypass hotspot (HKLM) ---
#reg_mssettings_hklm|HKLM:\SOFTWARE\Classes\ms-settings\Shell\Open\Command|SetValue|ms-settings UAC bypass (HKLM)

# --- UAC policy (HKLM) ---
reg_uac_policy|HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System|SetValue|UAC policy (HKLM)

# --- Shim persistence (HKLM) ---
reg_appcompat_custom|HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\Custom|SetValue|AppCompat Custom (HKLM)
reg_appcompat_installedsdb|HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\InstalledSDB|SetValue|InstalledSDB (HKLM)

# --- LSA / Session Manager (HKLM) ---
reg_lsa|HKLM:\SYSTEM\CurrentControlSet\Control\Lsa|SetValue|LSA (HKLM)
reg_sessionmgr|HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager|SetValue|Session Manager (HKLM)

# --- Net / Firewall (HKLM) ---
reg_netsh|HKLM:\SOFTWARE\Microsoft\NetSh|SetValue|NetSh settings (HKLM)
reg_fw_domain|HKLM:\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\DomainProfile|SetValue|Firewall DomainProfile (HKLM)
reg_fw_public|HKLM:\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\PublicProfile|SetValue|Firewall PublicProfile (HKLM)
reg_fw_standard|HKLM:\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile|SetValue|Firewall StandardProfile (HKLM)

# --- Optional HKCU (enable only when running under each real user context) ---
#reg_run_hkcu|HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run|SetValue,Delete|Run (HKCU)
#reg_runonce_hkcu|HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce|SetValue,Delete|RunOnce (HKCU)
#reg_startupapproved_hkcu|HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run|SetValue,Delete|StartupApproved Run (HKCU)
#reg_policy_explorer_run_hkcu|HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run|SetValue,Delete|Policies Explorer Run (HKCU)
#reg_winlogon_hkcu|HKCU:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon|SetValue|Winlogon (HKCU)
#reg_windows_hkcu|HKCU:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows|SetValue|Windows key (HKCU)
#reg_mssettings_hkcu|HKCU:\SOFTWARE\Classes\ms-settings\Shell\Open\Command|SetValue|ms-settings UAC bypass (HKCU)
