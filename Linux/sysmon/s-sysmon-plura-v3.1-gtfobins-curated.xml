<!-- PLURA_CONFIG_VERSION: s-sysmon-plura-v3.1-gtfobins-curated.xml --> 
<!-- PLURA_SCHEMA_TARGET: 4.90 -->

<Sysmon schemaversion="4.90">
  <EventFiltering>

    <!-- =========================================================
         Event ID 11: FileCreate
         Goal: detect suspicious "drops" in user/temp locations.
         ========================================================= -->

    <!-- (1) Malware-drop-style locations (user data + temp) with executable/script-like filenames -->
    <RuleGroup name="Include_MalwareDrop_Linux" groupRelation="or">
      <FileCreate onmatch="include">

        <!-- User home “honeypot-ish” locations -->
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">/home/</TargetFilename>
          <TargetFilename condition="contains any">/Documents/;/Desktop/;/Downloads/;/Pictures/;/Videos/;/Music/;/Client_Contracts/</TargetFilename>
          <TargetFilename condition="contains any">.sh;.bash;.zsh;.ksh;.py;.pl;.rb;.php;.js;.jar;.so;.bin;.run;.elf;.out;.AppImage</TargetFilename>
        </Rule>

        <!-- Root's common interactive locations -->
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">/root/</TargetFilename>
          <TargetFilename condition="contains any">/Downloads/;/Documents/;/Desktop/</TargetFilename>
          <TargetFilename condition="contains any">.sh;.bash;.py;.pl;.rb;.php;.js;.jar;.so;.bin;.run;.elf;.out;.AppImage</TargetFilename>
        </Rule>

        <!-- Temp locations (high-signal when writing scripts/binaries) -->
        <Rule groupRelation="and">
          <TargetFilename condition="begin with">/tmp/</TargetFilename>
          <TargetFilename condition="contains any">.sh;.bash;.py;.pl;.rb;.php;.js;.jar;.so;.bin;.run;.elf;.out;.AppImage</TargetFilename>
        </Rule>

        <Rule groupRelation="and">
          <TargetFilename condition="begin with">/var/tmp/</TargetFilename>
          <TargetFilename condition="contains any">.sh;.bash;.py;.pl;.rb;.php;.js;.jar;.so;.bin;.run;.elf;.out;.AppImage</TargetFilename>
        </Rule>

        <Rule groupRelation="and">
          <TargetFilename condition="begin with">/dev/shm/</TargetFilename>
          <TargetFilename condition="contains any">.sh;.bash;.py;.pl;.rb;.php;.js;.jar;.so;.bin;.run;.elf;.out;.AppImage</TargetFilename>
        </Rule>

        <Rule groupRelation="and">
          <TargetFilename condition="begin with">/run/user/</TargetFilename>
          <TargetFilename condition="contains any">.sh;.bash;.py;.pl;.rb;.php;.js;.jar;.so;.bin;.run;.elf;.out;.AppImage</TargetFilename>
        </Rule>

        <!-- Web roots (server-side drop/webshell staging) -->
        <Rule groupRelation="and">
          <TargetFilename condition="contains any">/var/www/;/srv/www/</TargetFilename>
          <TargetFilename condition="contains any">.php;.jsp;.asp;.aspx;.cgi;.pl;.py;.sh;.so;.bin;.elf</TargetFilename>
        </Rule>

      </FileCreate>
    </RuleGroup>

    <!-- (2) LOLBins/GTFOBins-style writers (curated) writing into common staging locations -->
    <RuleGroup name="Include_GTFOBins_Writers_Linux_Curated" groupRelation="or">
      <FileCreate onmatch="include">

        <!-- Network + scripting tools commonly used to download/write payloads -->
        <Rule groupRelation="and">
          <Image condition="contains any">/curl;/wget;/python;/python3;/perl;/ruby;/php;/node;/ssh;/scp;/sftp;/nc;/ncat;/socat;/ftp;/tftp;/base64;/openssl;/busybox</Image>
          <TargetFilename condition="contains any">/tmp/;/var/tmp/;/dev/shm/;/run/user/;/home/;/root/;/var/www/;/opt/;/srv/;/var/lib/</TargetFilename>
        </Rule>

        <!-- Archive/unpack tools: monitor writes into temp/download-ish areas -->
        <Rule groupRelation="and">
          <Image condition="contains any">/tar;/unzip;/7z;/gzip;/bzip2;/xz</Image>
          <TargetFilename condition="contains any">/tmp/;/var/tmp/;/dev/shm/;/run/user/;/home/;/root/</TargetFilename>
        </Rule>

        <!-- Shell redirection is very common; keep it higher-signal by requiring exec/script-like names and high-risk dirs -->
        <Rule groupRelation="and">
          <Image condition="contains any">/bash;/sh;/dash;/zsh;/ksh</Image>
          <TargetFilename condition="contains any">/tmp/;/var/tmp/;/dev/shm/;/run/user/</TargetFilename>
          <TargetFilename condition="contains any">.sh;.bash;.zsh;.ksh;.py;.pl;.rb;.php;.js;.jar;.so;.bin;.run;.elf;.out;.AppImage</TargetFilename>
        </Rule>

      </FileCreate>
    </RuleGroup>

    <!-- (3) Reduce noise: exclude expected package manager/temp behavior -->
    <RuleGroup name="Exclude_LegitActivity_Linux" groupRelation="or">
      <FileCreate onmatch="exclude">

        <!-- Common package managers / installers creating lots of temp and cache files -->
        <Rule groupRelation="and">
          <Image condition="contains any">/apt;/apt-get;/dpkg;/yum;/dnf;/rpm;/zypper;/pacman;/snap;/flatpak</Image>
          <TargetFilename condition="contains any">/tmp/;/var/tmp/;/var/cache/;/var/lib/</TargetFilename>
        </Rule>

        <!-- Common editor/transfer temp artifacts -->
        <TargetFilename condition="end with">.swp</TargetFilename>
        <TargetFilename condition="end with">.swx</TargetFilename>
        <TargetFilename condition="end with">.tmp</TargetFilename>
        <TargetFilename condition="end with">.part</TargetFilename>
        <TargetFilename condition="end with">.crdownload</TargetFilename>
        <TargetFilename condition="end with">~</TargetFilename>

      </FileCreate>
    </RuleGroup>

    <!-- =========================================================
         Event ID 1: ProcessCreate (optional but helpful correlation)
         Goal: detect execution from temp locations (common for payloads).
         ========================================================= -->
    <RuleGroup name="Include_Temp_Execution_Linux" groupRelation="or">
      <ProcessCreate onmatch="include">
        <Image condition="begin with">/tmp/</Image>
        <Image condition="begin with">/var/tmp/</Image>
        <Image condition="begin with">/dev/shm/</Image>
        <Image condition="begin with">/run/user/</Image>
      </ProcessCreate>
    </RuleGroup>

  </EventFiltering>
</Sysmon>
