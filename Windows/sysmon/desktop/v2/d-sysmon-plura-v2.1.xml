<!-- NOTICE: PLURA Sysmon Configuration File Version 2.1 (Desktop) -->
<!-- DOWNLOAD: https://learn.microsoft.com/ko-kr/sysinternals/downloads/sysmon -->
<!-- INSTALL: sysmon -accepteula -i "C:\Program Files (x86)\PLURA\sysmon-plura-v2.1-desktop.xml" -->
<!-- UPDATE: sysmon -c "C:\Program Files (x86)\PLURA\sysmon-plura-v2.1-desktop.xml" -->
<!-- DELETE: sysmon -u force -->
<!-- Sysmon v14.14 (2023.01.25) -->

<Sysmon schemaversion="4.83">
  <!-- META CONFIG -->
  <HashAlgorithms>*</HashAlgorithms>
  <CheckRevocation>False</CheckRevocation>
  <DnsLookup>False</DnsLookup>
  <ArchiveDirectory>Sysmon</ArchiveDirectory>

  <EventFiltering>
	
  <!-- EVENT ID 1 : PROCESS CREATION [ProcessCreate] -->
  <ProcessCreate onmatch="exclude">
    <!-- 데스크탑: 우선 전체 수집, 향후 노이즈 많은 프로세스만 exclude 추가 예정 -->
  </ProcessCreate>
 
  <!-- EVENT ID 2 : FILE CREATION TIME [FileCreateTime] -->
  <!-- Cannot be filtered. -->

  <!-- EVENT ID 3 : NETWORK CONNECTION [NetworkConnect] -->
  <NetworkConnect onmatch="exclude">
    <!-- PLURA 에이전트 통신은 제외 -->
    <Image condition="begin with">C:\Program Files (x86)\PLURA\</Image>
  </NetworkConnect>
	
  <!-- EVENT ID 4 : SYSMON SERVICE STATUS -->
  <!-- Cannot be filtered. -->
		
  <!-- EVENT ID 5 : PROCESS TERMINATED [ProcessTerminate] -->
  <ProcessTerminate onmatch="exclude">
    <!-- 데스크탑: 사용자 행위 타임라인 재구성용 전체 수집 -->
  </ProcessTerminate>

  <!-- EVENT ID 6 : DRIVER LOADED [DriverLoad] -->
  <!-- Cannot be filtered. -->

  <!-- EVENT ID 7 : IMAGE LOADED [ImageLoad] -->
  <RuleGroup name="" groupRelation="or">
    <ImageLoad onmatch="include">
      <ImageLoaded condition="Contains">System.Reflection.Dll</ImageLoaded>
      <ImageLoaded condition="Contains">System.Management.Automation.Dll</ImageLoaded>
      <ImageLoaded condition="Contains">System.Management.Automation.ni.Dll</ImageLoaded>
    </ImageLoad>
  </RuleGroup>

  <!-- EVENT ID 8 : REMOTE THREAD CREATED [CreateRemoteThread] -->
  <!-- Cannot be filtered. -->	
	
  <!-- EVENT ID 9 : RAW DISK ACCESS [RawAccessRead] -->
  <!-- Cannot be filtered. -->
	
  <!-- EVENT ID 10 : PROCESS ACCESS [ProcessAccess] -->
  <!-- Cannot be filtered. -->
	
  <!-- EVENT ID 11 : FILE CREATED [FileCreate] -->
  <RuleGroup name="" groupRelation="or">
    <FileCreate onmatch="include">
      <TargetFilename condition="contains">\Start Menu</TargetFilename> 
      <TargetFilename condition="contains">\Startup\</TargetFilename>
      <TargetFilename condition="contains">\Content.Outlook\</TargetFilename> 
      <TargetFilename condition="contains">\Downloads\</TargetFilename> 
      <TargetFilename condition="end with">.application</TargetFilename> 
      <TargetFilename condition="end with">.appref-ms</TargetFilename>
      <TargetFilename condition="end with">.bat</TargetFilename> 
      <TargetFilename condition="end with">.chm</TargetFilename>
      <TargetFilename condition="end with">.cmd</TargetFilename>
      <TargetFilename condition="end with">.cmdline</TargetFilename> 
      <TargetFilename condition="end with">.crx</TargetFilename> 
      <TargetFilename condition="end with">.dmp</TargetFilename> 
      <TargetFilename condition="end with">.docm</TargetFilename>
      <TargetFilename condition="end with">.dll</TargetFilename>
      <TargetFilename condition="end with">.exe</TargetFilename> 
      <TargetFilename condition="end with">.exe.log</TargetFilename>  
      <TargetFilename condition="end with">.jar</TargetFilename> 
      <TargetFilename condition="end with">.jnlp</TargetFilename>
      <TargetFilename condition="end with">.jse</TargetFilename>
      <TargetFilename condition="end with">.hta</TargetFilename> 
      <TargetFilename condition="end with">.job</TargetFilename> 
      <TargetFilename condition="end with">.pptm</TargetFilename> 
      <TargetFilename condition="end with">.ps1</TargetFilename>
      <TargetFilename condition="end with">.sys</TargetFilename>
      <TargetFilename condition="end with">.scr</TargetFilename>
      <TargetFilename condition="end with">.vbe</TargetFilename>
      <TargetFilename condition="end with">.vbs</TargetFilename>
      <TargetFilename condition="end with">.xlsm</TargetFilename>
      <TargetFilename condition="end with">proj</TargetFilename>
      <TargetFilename condition="end with">.sln</TargetFilename>

      <TargetFilename condition="begin with">C:\Users\Default</TargetFilename> 
      <TargetFilename condition="begin with">C:\Windows\system32\Drivers</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\SysWOW64\Drivers</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\system32\GroupPolicy\Machine\Scripts</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\system32\GroupPolicy\User\Scripts</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\system32\Wbem</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\SysWOW64\Wbem</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\system32\WindowsPowerShell</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\SysWOW64\WindowsPowerShell</TargetFilename>

      <!-- PLURA 중요 파일 -->
      <TargetFilename condition="begin with">C:\Windows\System32\drivers\etc\hosts</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\System32\winevt\Logs</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\System32\config\SAM</TargetFilename>
      <TargetFilename condition="begin with">C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</TargetFilename>
      <TargetFilename condition="begin with">C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup</TargetFilename>
      <TargetFilename condition="begin with">C:\Users\Administrator</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\Tasks\</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\system32\Tasks</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\SysWOW64\Tasks</TargetFilename>

      <!-- 환경변수 기반 경로 보완 -->
      <TargetFilename condition="begin with">C:\Windows\system32\</TargetFilename>
      <TargetFilename condition="begin with">C:\Users\Default\</TargetFilename>
      <TargetFilename condition="contains">\AppData\Roaming\</TargetFilename>
      <TargetFilename condition="contains">\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</TargetFilename>
      <TargetFilename condition="begin with">C:\Program Files\Common Files\</TargetFilename>
      <TargetFilename condition="begin with">C:\Program Files (x86)\Common Files</TargetFilename>

      <!-- 섀도우 카피 접근 -->
      <TargetFilename condition="contains">\Device\HarddiskVolumeShadowCopy</TargetFilename>

      <!--Windows application compatibility-->
      <TargetFilename condition="begin with">C:\Windows\AppPatch\Custom</TargetFilename> 
      <TargetFilename condition="contains">VirtualStore</TargetFilename> 
      <!--Exploitable file names-->
      <TargetFilename condition="end with">.xls</TargetFilename> 
      <TargetFilename condition="end with">.ppt</TargetFilename> 
      <TargetFilename condition="end with">.rtf</TargetFilename>
    </FileCreate>
  </RuleGroup>

  <RuleGroup name="" groupRelation="or">
    <FileCreate onmatch="exclude">
      <!--SECTION: Microsoft-->
      <Image condition="is">C:\Program Files (x86)\EMET 5.5\EMET_Service.exe</Image> 
      <!--SECTION: Microsoft:Office:Click2Run-->
      <Image condition="is">C:\Program Files\Common Files\Microsoft Shared\ClickToRun\OfficeC2RClient.exe</Image>
      <!--SECTION: Windows-->
      <Image condition="is">C:\Windows\system32\smss.exe</Image>
      <Image condition="is">C:\Windows\system32\CompatTelRunner.exe</Image>
      <Image condition="is">\\?\C:\Windows\system32\wbem\WMIADAP.EXE</Image> 
      <Image condition="is">C:\Windows\system32\mobsync.exe</Image>
      <TargetFilename condition="begin with">C:\Windows\system32\DriverStore\Temp\</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\system32\wbem\Performance\</TargetFilename> 
      <TargetFilename condition="begin with">C:\Windows\Installer\</TargetFilename> 
      <!--SECTION: Windows:Updates-->
      <TargetFilename condition="begin with">C:\$WINDOWS.~BT\Sources\</TargetFilename> 
      <Image condition="begin with">C:\Windows\winsxs\amd64_microsoft-windows</Image> 
      <Image condition="begin with">C:\Program files (x86)\PLURA</Image>
    </FileCreate>
  </RuleGroup>

  <!-- EVENT ID 12/13/14 : REGISTRY MODIFICATION [RegistryEvent] -->
  <RuleGroup name="" groupRelation="or">
    <RegistryEvent onmatch="include">		
      <TargetObject condition="contains">Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run</TargetObject>
      <TargetObject condition="contains">SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders</TargetObject> 
      <TargetObject condition="contains">Software\Microsoft\Active Setup\Installed Components</TargetObject> 
      <TargetObject condition="contains">SOFTWARE\Microsoft\Windows\CurrentVersion\Run</TargetObject> 
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</TargetObject> 
      <TargetObject condition="contains">\Software\Wow6432Node\Microsoft\Active Setup\Installed Components</TargetObject> 
      <TargetObject condition="contains">HKLM\SYSTEM\CurrentControlSet\services\USBSTOR</TargetObject> 
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\batfile\shell\print\command</TargetObject> 
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\batfile\shell\runas\command</TargetObject> 
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\cmdfile\shell\print\command</TargetObject> 
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\cmdfile\shell\runas\command</TargetObject> 
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\cmdfile\shellex\ContextMenuHandlers\Compatibility</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\Directory\shell\cmd\command</TargetObject>  
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\exefile\shell\runas\command</TargetObject> 
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\exefile\shellex\ContextMenuHandlers\Compatibility</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\NOHIDDEN</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\SHOWALL</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\HideFileExt</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\SuperHidden</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\ControlSet002\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Defaults\FirewallPolicy\StandardProfile\Logging</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\CurrentControlSet\services\SharedAccess\Parameters\FirewallPolicy\StandardProfile</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\CurrentControlSet\Control\SafeBoot</TargetObject>
      <TargetObject condition="contains">HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Connections</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\ControlSet001\services\USBSTOR</TargetObject>
      <TargetObject condition="contains">SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\batfile\shell\edit\command</TargetObject>		
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\cmdfile\shell\open\command</TargetObject>		
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\comfile\shell\open\command</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\Directory\background\shell\cmd\command</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\exefile\shell\open\command</TargetObject>		
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\Folder\shell\open\command</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\htafile\shell\open\command</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Classes\mscfile\shell\open\command</TargetObject>		
      <TargetObject condition="contains">SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Advanced</TargetObject>		
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\URL\DefaultPrefix</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\ControlSet001\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile</TargetObject>		
      <TargetObject condition="contains">HKLM\SYSTEM\ControlSet001\Control\SafeBoot</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\CurrentControlSet\Services\wscsvc\Parameters</TargetObject>
      <TargetObject condition="contains">HKLM\SYSTEM\CurrentControlSet\Services\RemoteAccess\RouterManagers\Ip</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\SystemCertificates\AuthRoot\Certificates\DAC9024F54D8F6DF94935FB1732638CA6AD77C13</TargetObject>
      <TargetObject condition="contains">Software\Microsoft\Windows\CurrentVersion\Internet Settings</TargetObject>
      <TargetObject condition="contains">Control Panel\Desktop</TargetObject>
      <TargetObject condition="contains">Software\Microsoft\Internet Explorer\TypedURLs</TargetObject>
      <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\Folders</TargetObject>		
    </RegistryEvent>
  </RuleGroup>

  <!-- EVENT ID 15 : FILE CREATE STREAM HASH [FileCreateStreamHash] -->
  <!-- Cannot be filtered. -->

  <!-- EVENT ID 16 : CONFIGURATION CHANGE -->
  <!-- Cannot be filtered. -->

  <!-- EVENT ID 17 & 18 : PIPE CREATED / PIPE CONNECTED [PipeEvent] -->
  <!-- Cannot be filtered. -->
		
  <!-- EVENT ID 19/20/21 : WMI EVENT [WmiEvent] -->
  <!-- Cannot be filtered. -->

  <!-- EVENT ID 22 : DNS QUERY [DnsQuery] -->
  <DnsQuery onmatch="include">
    <Image condition="end with">powershell.exe</Image>
    <Image condition="end with">pwsh.exe</Image>
    <Image condition="end with">cmd.exe</Image>
    <Image condition="end with">wscript.exe</Image>
    <Image condition="end with">cscript.exe</Image>
    <Image condition="end with">mshta.exe</Image>
    <Image condition="end with">regsvr32.exe</Image>
    <Image condition="end with">rundll32.exe</Image>
  </DnsQuery>

  <!-- EVENT ID 27 : FILE BLOCK EXECUTABLE [FileBlockExecutable] - Desktop (강화 버전) -->
  <RuleGroup name="Include_MalwareDrop_Desktop" groupRelation="or">
    <FileBlockExecutable onmatch="include">

      <!-- (A) 사용자 데이터 보호 (Honeypot) -->
      <Rule groupRelation="and">
        <TargetFilename condition="begin with">C:\Users\</TargetFilename>
        <TargetFilename condition="contains any">
          \Documents\;
          \Pictures\;
          \Videos\;
          \Music\;
          \Favorites\;
          \Client_Contracts\
        </TargetFilename>
      </Rule>

      <!-- (B) 공격자 임시 Drop & Run 경로 -->
      <TargetFilename condition="begin with">C:\Temp\</TargetFilename>
      <TargetFilename condition="begin with">C:\Windows\Temp\</TargetFilename>

      <!-- (C) User Local Temp -->
      <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>

      <!-- (D) User Roaming -->
      <TargetFilename condition="contains">\AppData\Roaming\</TargetFilename>

      <!-- (E) ProgramData 내부 임시 폴더 -->
      <TargetFilename condition="contains any">
        C:\ProgramData\Temp\;
        C:\ProgramData\Updater\;
        C:\ProgramData\Random\
      </TargetFilename>

      <!-- (F) Office 체인 → Temp/Roaming EXE 생성 시 차단 -->
      <Rule groupRelation="and">
        <Image condition="contains any">
          OUTLOOK.exe;
          WINWORD.exe;
          POWERPNT.exe;
          EXCEL.exe;
          VISIO.exe;
          MSACCESS.exe;
          MSPUB.exe;
          EQNEDT32.exe;
          TEAMS.exe;
          LYNC.exe
        </Image>
        <TargetFilename condition="contains any">
          \Temp\;
          \AppData\Local\Temp\;
          \AppData\Roaming\
        </TargetFilename>
      </Rule>

      <!-- (G) ZIP 기반 랜섬웨어 Drop (7z.exe 사용) -->
      <Rule groupRelation="and">
        <Image condition="end with">7z.exe</Image>
        <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
      </Rule>

      <!-- (H) PowerShell → Temp/LocalTemp/Roaming/ProgramData EXE/DLL 생성 차단 -->
      <Rule groupRelation="and">
        <Image condition="end with">powershell.exe</Image>
        <TargetFilename condition="contains any">
          \Temp\;
          \AppData\Local\Temp\;
          \AppData\Roaming\;
          C:\ProgramData\
        </TargetFilename>
      </Rule>

      <!-- (I) LOLBin(mshta) → Drop 차단 -->
      <Rule groupRelation="and">
        <Image condition="end with">mshta.exe</Image>
        <TargetFilename condition="contains any">
          \Temp\;
          \AppData\Local\Temp\;
          \AppData\Roaming\;
          C:\ProgramData\
        </TargetFilename>
      </Rule>

      <!-- (J) LOLBin(regsvr32) → Drop 차단 -->
      <Rule groupRelation="and">
        <Image condition="end with">regsvr32.exe</Image>
        <TargetFilename condition="contains any">
          \Temp\;
          \AppData\Local\Temp\;
          \AppData\Roaming\;
          C:\ProgramData\
        </TargetFilename>
      </Rule>

      <!-- 필요 시 아래 주석 해제해서 wscript/rundll32 도 포함 가능
      <Rule groupRelation="and">
        <Image condition="end with">wscript.exe</Image>
        <TargetFilename condition="contains any">
          \Temp\;
          \AppData\Local\Temp\;
          \AppData\Roaming\;
          C:\ProgramData\
        </TargetFilename>
      </Rule>

      <Rule groupRelation="and">
        <Image condition="end with">rundll32.exe</Image>
        <TargetFilename condition="contains any">
          \Temp\;
          \AppData\Local\Temp\;
          \AppData\Roaming\;
          C:\ProgramData\
        </TargetFilename>
      </Rule>
      -->

    </FileBlockExecutable>
  </RuleGroup>

  <RuleGroup name="Exclude_LegitActivity_Desktop" groupRelation="or">
    <FileBlockExecutable onmatch="exclude">

      <!-- (1) Outlook/Office 정상 임시 파일 -->
      <TargetFilename condition="contains">Content.Outlook\</TargetFilename>
      <TargetFilename condition="contains">Content.MSO\</TargetFilename>
      <TargetFilename condition="end with">MSForms.exd</TargetFilename>
      <TargetFilename condition="contains">~$</TargetFilename>

      <!-- (2) 정상 다운로드 폴더 -->
      <Rule groupRelation="and">
        <TargetFilename condition="begin with">C:\Users\</TargetFilename>
        <TargetFilename condition="contains">\Downloads\</TargetFilename>
      </Rule>

      <!-- (3) PowerShell Profile 업데이트 -->
      <Rule groupRelation="and">
        <TargetFilename condition="begin with">C:\Users\</TargetFilename>
        <TargetFilename condition="contains">\Documents\WindowsPowerShell\</TargetFilename>
      </Rule>

      <!-- (4) Windows Installer / Update -->
      <Image condition="is">C:\Windows\System32\msiexec.exe</Image>
      <Image condition="is">C:\Windows\servicing\TrustedInstaller.exe</Image>
      <Image condition="is">C:\Windows\System32\TiWorker.exe</Image>
      <Image condition="is">C:\Windows\System32\dism.exe</Image>
      <Image condition="is">C:\Windows\System32\wusa.exe</Image>
      <Image condition="is">C:\Windows\System32\cleanmgr.exe</Image>
      <Image condition="is">C:\Windows\System32\wuauclt.exe</Image>

      <!-- (5) Windows 오류보고/진단 -->
      <Image condition="is">C:\Windows\System32\werfault.exe</Image>
      <Image condition="is">C:\Windows\System32\wermgr.exe</Image>

      <!-- (6) Windows CAB/압축 관련 -->
      <Image condition="is">C:\Windows\System32\makecab.exe</Image>
      <Image condition="is">C:\Windows\System32\iexpress.exe</Image>

      <!-- (7) 보안 솔루션 필수 예외 -->
      <Image condition="contains any">
        C:\ProgramData\Microsoft\Windows Defender\Platform\;
        MsMpEng.exe
      </Image>
      <Image condition="end with">MpSigStub.exe</Image>
      <Image condition="end with">NisSrv.exe</Image>
      <Image condition="end with">Sysmon.exe</Image>

      <!-- (8) Python 개발 환경 -->
      <Image condition="contains">\venv\Scripts\python.exe</Image>
      <Image condition="contains">\python.exe</Image>
      <Image condition="contains">\pip.exe</Image>

      <!-- (9) 브라우저/전자회의/Electron 업데이트 -->
      <Image condition="contains any">
        chrome.exe;
        msedge.exe;
        Squirrel.exe;
        Update.exe;
        Discord.exe;
        Teams.exe;
        Zoom.exe
      </Image>

      <!-- (10) RMM / 백업 / 모니터링 에이전트 -->
      <Image condition="contains any">
        agent;
        updater;
        backup;
        monitor
      </Image>

      <!-- (11) OneDrive -->
      <Image condition="end with">OneDrive.exe</Image>

    </FileBlockExecutable>
  </RuleGroup>

  </EventFiltering>
</Sysmon>
