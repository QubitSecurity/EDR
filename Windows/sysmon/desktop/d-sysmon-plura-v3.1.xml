<!-- PLURA_CONFIG_VERSION: d-sysmon-plura-v3.1.xml --> 
<!-- PLURA_SCHEMA_TARGET: 4.90 -->

<Sysmon schemaversion="5.0">
  <HashAlgorithms>*</HashAlgorithms>
  <CheckRevocation>False</CheckRevocation>
  <DnsLookup>False</DnsLookup>
  <ArchiveDirectory>Sysmon</ArchiveDirectory>
  <EventFiltering>
    <!-- ============================================================ -->
    <!-- Event ID 1: Process Create (Desktop: LOLBAS/스크립트/브라우저 기반 초기침투 중심) -->
    <!-- ============================================================ -->
    <!-- (1) 노이즈/PLURA 자체 프로세스 제외 -->
    <RuleGroup name="ProcessCreate-Exclude-Noise" groupRelation="or">
      <ProcessCreate onmatch="exclude">
        <!-- PLURA Agent / Tools -->
        <ParentImage condition="end with">\Program Files (x86)\PLURA\PLURAService.exe</ParentImage>
        <ParentImage condition="end with">\Program Files (x86)\PLURA\PLURASControl.exe</ParentImage>
        <ParentImage condition="end with">\Program Files (x86)\PLURA\PLURAConfig.exe</ParentImage>
        <ParentImage condition="end with">\Program Files (x86)\PLURA\PLURATray.exe</ParentImage>
        <!-- Windows common noise -->
        <Image condition="end with">\Windows\System32\RuntimeBroker.exe</Image>
        <Image condition="end with">\Windows\System32\backgroundTaskHost.exe</Image>
        <!-- .NET ngen / mscorsvw compilation noise -->
        <CommandLine condition="begin with">C:\Windows\Microsoft.NET\Framework\v4.0.30319\ngen.exe</CommandLine>
        <Image condition="is">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe</Image>
        <Image condition="is">C:\Windows\Microsoft.NET\Framework\v4.0.30319\mscorsvw.exe</Image>
      </ProcessCreate>
    </RuleGroup>
    <!-- (2) Desktop 주요 공격 표면 Include -->
    <RuleGroup name="ProcessCreate-Include-Desktop" groupRelation="or">
      <ProcessCreate onmatch="include">
        <!-- Script / LOLBAS -->
        <Image condition="end with">\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Image>
        <Image condition="end with">\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe</Image>
        <Image condition="end with">\Windows\System32\pwsh.exe</Image>
        <Image condition="end with">\Windows\System32\cmd.exe</Image>
        <Image condition="end with">\Windows\System32\cscript.exe</Image>
        <Image condition="end with">\Windows\System32\wscript.exe</Image>
        <Image condition="end with">\Windows\System32\mshta.exe</Image>
        <Image condition="end with">\Windows\System32\rundll32.exe</Image>
        <Image condition="end with">\Windows\System32\regsvr32.exe</Image>
        <!-- Downloaders / living-off-the-land -->
        <Image condition="end with">\Windows\System32\certutil.exe</Image>
        <Image condition="end with">\Windows\System32\bitsadmin.exe</Image>
        <Image condition="end with">\Windows\System32\curl.exe</Image>
        <Image condition="end with">\Windows\System32\wget.exe</Image>
        <!-- Office child processes are high signal -->
        <Image condition="end with">\WINWORD.EXE</Image>
        <Image condition="end with">\EXCEL.EXE</Image>
        <Image condition="end with">\POWERPNT.EXE</Image>
        <Image condition="end with">\OUTLOOK.EXE</Image>
        <!-- Browsers -->
        <Image condition="end with">\chrome.exe</Image>
        <Image condition="end with">\msedge.exe</Image>
        <Image condition="end with">\firefox.exe</Image>
        <!-- Suspicious execution in user-writable locations -->
        <Rule groupRelation="and">
          <Image condition="contains">\Users\</Image>
          <Image condition="contains any">\AppData\;\Downloads\;\Desktop\;</Image>
        </Rule>
        <Rule groupRelation="and">
          <Image condition="contains">\AppData\Local\Temp\</Image>
        </Rule>
      </ProcessCreate>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 3: Network Connect (Desktop: 브라우저/스크립트 엔진/원격도구 중심) -->
    <!-- ============================================================ -->
    <!-- (1) 노이즈/PLURA 제외 -->
    <RuleGroup name="NetworkConnect-Exclude-Noise" groupRelation="or">
      <NetworkConnect onmatch="exclude">
        <!-- PLURA -->
        <Image condition="contains">:\Program Files (x86)\PLURA\</Image>
        <!-- Multicast / loopback -->
        <SourceIp condition="begin with">224.0.0.</SourceIp>
        <SourceIp condition="begin with">ff02:0:0:0:0:0:1:</SourceIp>
        <SourceIp condition="is">239.255.255.250</SourceIp>
        <SourceIp condition="is">0:0:0:0:0:0:0:1</SourceIp>
        <DestinationIp condition="is">239.255.255.250</DestinationIp>
        <DestinationIp condition="is">0:0:0:0:0:0:0:1</DestinationIp>
        <!-- Windows Update / Microsoft -->
      </NetworkConnect>
    </RuleGroup>
    <!-- (2) 고신호 Outbound Include -->
    <RuleGroup name="NetworkConnect-Include-Desktop" groupRelation="or">
      <NetworkConnect onmatch="include">
        <!-- PowerShell outbound -->
        <Image condition="end with">\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Image>
        <Image condition="end with">\Windows\System32\pwsh.exe</Image>
        <!-- Script engines outbound -->
        <Image condition="end with">\Windows\System32\wscript.exe</Image>
        <Image condition="end with">\Windows\System32\cscript.exe</Image>
        <Image condition="end with">\Windows\System32\mshta.exe</Image>
        <!-- LOLBins outbound -->
        <!-- RDP / SMB / WinRM indicative ports -->
        <Image condition="end with">\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe</Image>
        <Image condition="end with">\Windows\SysWOW64\wscript.exe</Image>
        <Image condition="end with">\Windows\SysWOW64\cscript.exe</Image>
        <Image condition="end with">\Windows\SysWOW64\mshta.exe</Image>
        <Image condition="end with">\Windows\System32\rundll32.exe</Image>
        <Image condition="end with">\Windows\SysWOW64\rundll32.exe</Image>
        <Image condition="end with">\Windows\System32\regsvr32.exe</Image>
        <Image condition="end with">\Windows\SysWOW64\regsvr32.exe</Image>
        <Image condition="end with">\Windows\System32\wmic.exe</Image>
        <Image condition="end with">\Windows\SysWOW64\wmic.exe</Image>
        <Image condition="end with">\Windows\System32\certutil.exe</Image>
        <Image condition="end with">\Windows\System32\bitsadmin.exe</Image>
        <Image condition="end with">\Windows\System32\curl.exe</Image>
        <Image condition="end with">\Windows\System32\wget.exe</Image>
        <DestinationPort condition="is">3389</DestinationPort>
        <DestinationPort condition="is">445</DestinationPort>
        <DestinationPort condition="is">5985</DestinationPort>
        <DestinationPort condition="is">5986</DestinationPort>
      </NetworkConnect>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 5: Process Terminate (기본 노이즈 제외) -->
    <!-- ============================================================ -->
    <RuleGroup name="ProcessTerminate-Exclude-Noise" groupRelation="or">
      <ProcessTerminate onmatch="exclude">
        <Image condition="end with">\Windows\System32\backgroundTaskHost.exe</Image>
        <Image condition="end with">\Windows\System32\RuntimeBroker.exe</Image>
        <Image condition="end with">\Sysmon\Sysmon64.exe</Image>
        <Image condition="end with">\Sysmon\Sysmon.exe</Image>
      </ProcessTerminate>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 7: ImageLoad (PowerShell 관련 DLL 로딩 추적 유지) -->
    <!-- ============================================================ -->
    <RuleGroup name="ImageLoad-PowerShell" groupRelation="and">
      <ImageLoad onmatch="include">
        <Rule groupRelation="or">
          <ImageLoaded condition="contains">System.Management.Automation</ImageLoaded>
          <ImageLoaded condition="contains">System.Reflection</ImageLoaded>
          <ImageLoaded condition="contains">sspisrv.dll</ImageLoaded>
        </Rule>
      </ImageLoad>
      <ImageLoad onmatch="exclude">
        <Rule groupRelation="or">
          <Image condition="end with">\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe</Image>
          <Image condition="end with">\Windows\System32\WindowsPowerShell\v1.0\powershell.exe</Image>
          <Image condition="end with">\Windows\System32\WindowsPowerShell\v1.0\powershell_ise.exe</Image>
        </Rule>
      </ImageLoad>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 9: RawAccessRead (데스크톱에서도 유효하지만 노이즈 관리) -->
    <!-- ============================================================ -->
    <RuleGroup name="RawAccessRead-Desktop" groupRelation="and">
      <RawAccessRead onmatch="include">
        <Device condition="contains">\Device\Harddisk0\DR0</Device>
      </RawAccessRead>
      <RawAccessRead onmatch="exclude">
        <Rule groupRelation="or">
          <Image condition="contains all">\ProgramData\Microsoft\Windows Defender\platform\;\MsMpEng.exe</Image>
          <Image condition="contains">\Windows\System32\</Image>
          <Image condition="contains">\Windows\SysWOW64\</Image>
        </Rule>
      </RawAccessRead>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 11: FileCreate (Desktop: 사용자 경로/다운로드/오피스/시작프로그램/스크립트 중심) -->
    <!-- ============================================================ -->
    <RuleGroup name="FileCreate-Include-DesktopCore" groupRelation="or">
      <FileCreate onmatch="include">
        <!-- Startup / Start Menu -->
        <TargetFilename condition="contains">\Start Menu</TargetFilename>
        <TargetFilename condition="contains">\Startup\</TargetFilename>
        <!-- Downloads / Desktop / Temp -->
        <Rule groupRelation="and">
          <TargetFilename condition="contains any">\Downloads\;\Desktop\;\AppData\Local\Temp\;</TargetFilename>
          <TargetFilename condition="contains any">.exe;.dll;.ps1;.vbs;.js;.jse;.hta;.bat;.cmd;.scr;.msi;.lnk</TargetFilename>
        </Rule>
        <!-- Office & email attachment caches -->
        <TargetFilename condition="contains">\Content.Outlook\</TargetFilename>
        <TargetFilename condition="contains">\INetCache\Content.Outlook\</TargetFilename>
        <TargetFilename condition="contains any">.docm;.xlsm;.pptm;.rtf;.lnk;.iso;.img</TargetFilename>
        <!-- Key system locations worth watching even on desktop -->
        <TargetFilename condition="begin with">C:\Windows\System32\drivers\etc\hosts</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\Tasks\</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\Tasks\</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\SysWOW64\Tasks\</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\GroupPolicy\Machine\Scripts</TargetFilename>
        <TargetFilename condition="begin with">C:\Windows\System32\GroupPolicy\User\Scripts</TargetFilename>
        <!-- Browser extensions (install/persistence) -->
        <TargetFilename condition="contains">\AppData\Local\Google\Chrome\User Data\Default\Extensions\</TargetFilename>
        <TargetFilename condition="contains">\AppData\Local\Microsoft\Edge\User Data\Default\Extensions\</TargetFilename>
      </FileCreate>
    </RuleGroup>
    <RuleGroup name="FileCreate-Exclude-PLURA" groupRelation="or">
      <FileCreate onmatch="exclude">
        <Image condition="end with">\Program Files (x86)\PLURA\PLURAService.exe</Image>
        <Image condition="end with">\Program Files (x86)\PLURA\PLURASControl.exe</Image>
        <Image condition="end with">\Program Files (x86)\PLURA\PLURAConfig.exe</Image>
        <Image condition="end with">\Program Files (x86)\PLURA\PLURATray.exe</Image>
      </FileCreate>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 12/13/14: RegistryEvent (Desktop persistence / policy tamper 중심) -->
    <!-- ============================================================ -->
    <RuleGroup name="RegistryEvent-Include-DesktopCore" groupRelation="or">
      <RegistryEvent onmatch="include">
        <!-- Run keys / Startup -->
        <TargetObject condition="contains">\CurrentVersion\Run</TargetObject>
        <TargetObject condition="contains">\Policies\Explorer\Run</TargetObject>
        <TargetObject condition="contains">Explorer\User Shell Folders\Startup</TargetObject>
        <!-- Winlogon -->
        <TargetObject condition="contains">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon</TargetObject>
        <!-- IFEO -->
        <TargetObject condition="begin with">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</TargetObject>
        <!-- PowerShell logging tamper -->
        <TargetObject condition="contains">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging</TargetObject>
        <TargetObject condition="contains">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\ModuleLogging</TargetObject>
        <TargetObject condition="contains">HKLM\SOFTWARE\Policies\Microsoft\Windows\PowerShell\Transcription</TargetObject>
        <!-- Defender tamper (common desktop scenario) -->
        <TargetObject condition="contains">HKLM\SOFTWARE\Policies\Microsoft\Windows Defender</TargetObject>
      </RegistryEvent>
    </RuleGroup>
    <RuleGroup name="RegistryEvent-Exclude-PLURA-Noise" groupRelation="or">
      <RegistryEvent onmatch="exclude">
        <Image condition="begin with">C:\Program Files (x86)\PLURA\</Image>
        <Image condition="begin with">C:\Program Files\PLURA\</Image>
      </RegistryEvent>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 15: FileCreateStreamHash (Zone.Identifier / scripts) -->
    <!-- ============================================================ -->
    <RuleGroup name="FileCreateStreamHash-Desktop" groupRelation="or">
      <FileCreateStreamHash onmatch="include">
        <Rule name="ZoneIdentifier" groupRelation="and">
          <TargetFilename condition="end with">:Zone.Identifier</TargetFilename>
          <Contents condition="contains any">about:internet;blob:</Contents>
        </Rule>
        <TargetFilename condition="end with">.ps1</TargetFilename>
        <TargetFilename condition="end with">.psm1</TargetFilename>
        <TargetFilename condition="end with">.vbs</TargetFilename>
        <TargetFilename condition="end with">.js</TargetFilename>
      </FileCreateStreamHash>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 22: DNS Query (Desktop: 특정 IOC 유지 가능) -->
    <!-- ============================================================ -->
    <RuleGroup name="DnsQuery-IOC" groupRelation="or">
      <DnsQuery onmatch="include">
        <!-- 기존 예시 IOC 유지(필요 시 교체) -->
        <QueryName condition="end with">tcjst.com</QueryName>
      </DnsQuery>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 23/26: FileDelete / FileDeleteDetected -->
    <!-- - 23은 디스크 영향 고려: off 유지 -->
    <!-- - 26은 사용자 경로/임시폴더 기반 삭제 행위 중심 -->
    <!-- ============================================================ -->
    <RuleGroup name="FileDelete-ArchivedCopy-Disabled" groupRelation="or">
      <FileDelete onmatch="exclude"/>
    </RuleGroup>
    <RuleGroup name="FileDeleteDetected-Include-DesktopCore" groupRelation="or">
      <FileDeleteDetected onmatch="include">
        <Rule groupRelation="and">
          <TargetFilename condition="contains">\Downloads\</TargetFilename>
          <TargetFilename condition="contains any">.exe;.dll;.ps1;.vbs;.js;.jse;.hta;.bat;.cmd;.scr;.msi;.lnk</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
          <TargetFilename condition="contains any">.exe;.dll;.ps1;.vbs;.js;.jse;.hta;.bat;.cmd;.scr;.msi;.lnk</TargetFilename>
        </Rule>
        <Rule groupRelation="and">
          <TargetFilename condition="contains">\INetCache\Content.Outlook\</TargetFilename>
          <TargetFilename condition="contains any">.exe;.dll;.ps1;.vbs;.js;.jse;.hta;.bat;.cmd;.scr;.msi;.lnk;.docm;.xlsm;.pptm;.rtf</TargetFilename>
        </Rule>
      </FileDeleteDetected>
    </RuleGroup>
    <RuleGroup name="FileDeleteDetected-Exclude-CommonNoise" groupRelation="or">
      <FileDeleteDetected onmatch="exclude">
        <Image condition="contains all">\appdata\local\google\chrome\user data\swreporter\;software_reporter_tool.exe</Image>
        <User condition="contains any">NETWORK SERVICE;LOCAL SERVICE</User>
      </FileDeleteDetected>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- Event ID 8: CreateRemoteThread (Injection signal) -->
    <!-- ============================================================ -->
    <RuleGroup name="CreateRemoteThread-Include" groupRelation="or">
      <CreateRemoteThread onmatch="include">
        <SourceImage condition="begin with">C:\</SourceImage>
        <SourceImage condition="begin with">\\</SourceImage>
      </CreateRemoteThread>
    </RuleGroup>
    <!-- ============================================================ -->
    <!-- NOTE: Event ID 27 (FileBlockExecutable) is intentionally NOT included -->
    <!-- ============================================================ -->
  </EventFiltering>
</Sysmon>
