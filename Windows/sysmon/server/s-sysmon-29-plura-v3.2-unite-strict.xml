<!-- PLURA_CONFIG_VERSION : s-sysmon-29-plura-v3.2-unite-strict.xml -->
<!-- PLURA_SCHEMA_TARGET: 4.90 -->

<Sysmon schemaversion="4.90">
  
	
  <HashAlgorithms>*</HashAlgorithms>
  
	
  <EventFiltering>
    
		
		
		
    <RuleGroup name="Defult_ProcessCreate" groupRelation="or">
      
			
      <ProcessCreate onmatch="exclude">
        
				
        <Rule name="PLURA_Syslog" groupRelation="and">
          
					
          <Image condition="contains">logger</Image>
          
					
          <ParentImage condition="contains">bash</ParentImage>
          
					
          <CommandLine condition="contains">-p local0.notice</CommandLine>
          
					
          <CommandLine condition="contains">-t bash -i --</CommandLine>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Disk Use" groupRelation="and">
          
					
          <CurrentDirectory condition="is">/etc/plura</CurrentDirectory>
          
					
          <CommandLine condition="begin with">sh -c df -h</CommandLine>
          
					
          <CommandLine condition="contains">awk '$NF==</CommandLine>
          
					
          <CommandLine condition="end with">$(NF-1)}'</CommandLine>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Disk Use_gawk" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gawk</Image>
          
					
          <CurrentDirectory condition="is">/etc/plura</CurrentDirectory>
          
					
          <CommandLine condition="begin with">awk $NF==</CommandLine>
          
					
          <CommandLine condition="contains">{printf</CommandLine>
          
					
          <CommandLine condition="end with">, $(NF-1)}</CommandLine>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Disk Use_df" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/df</Image>
          
					
          <CurrentDirectory condition="is">/etc/plura</CurrentDirectory>
          
					
          <CommandLine condition="is">df -h</CommandLine>
          
				
        </Rule>
        
				
				
				
        <Rule name="PLURA_Execution_Mem Use_free" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/free</Image>
          
					
          <CurrentDirectory condition="is">/etc/plura</CurrentDirectory>
          
					
          <CommandLine condition="is">free -m</CommandLine>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Mem Use" groupRelation="and">
          
					
          <CurrentDirectory condition="is">/etc/plura</CurrentDirectory>
          
					
          <CommandLine condition="begin with">sh -c free -m | awk 'NR==2{printf &quot;%.2f%%&quot;, $3*100/$2 }'</CommandLine>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Mem Use_gawk" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gawk</Image>
          
					
          <CurrentDirectory condition="is">/etc/plura</CurrentDirectory>
          
					
          <CommandLine condition="begin with">awk NR==2{printf</CommandLine>
          
					
          <CommandLine condition="end with">, $3*100/$2 }</CommandLine>
          
				
        </Rule>
        
				
				
        <Rule name="PLURA_Execution_log gzip" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gzip</Image>
          
					
          <CommandLine condition="is">/bin/gzip /var/log/plura/agent/event.log</CommandLine>
          
					
          <ParentImage condition="is">/usr/bin/bash</ParentImage>
          
					
          <User condition="is">root</User>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log rm_weblog" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/rm</Image>
          
					
          <CommandLine condition="begin with">rm -f /var/log/plura/weblog</CommandLine>
          
					
          <ParentImage condition="is">/usr/bin/bash</ParentImage>
          
					
          <User condition="is">root</User>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log rm_evnetlog" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/rm</Image>
          
					
          <CommandLine condition="begin with">rm -f /var/log/plura/agent/event.log.gz</CommandLine>
          
					
          <ParentImage condition="is">/usr/bin/bash</ParentImage>
          
					
          <User condition="is">root</User>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log wc" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/wc</Image>
          
					
          <CommandLine condition="is">wc -c /var/log/plura/agent/event.log</CommandLine>
          
					
          <User condition="is">root</User>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log mv" groupRelation="or">
          
					
          <CommandLine condition="begin with">mv /var/log/plura/weblog*.log /var/log/plura/weblog*.log-</CommandLine>
          
					
          <CommandLine condition="begin with">mv /var/log/plura/ceelog-127.0.0.1.log /var/log/plura/ceelog-127.0.0.1.log-</CommandLine>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_timer" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/bash</Image>
          
					
          <CommandLine condition="begin with">/bin/bash /etc/plura/plura.sh timer</CommandLine>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Defend" groupRelation="and">
          
					
          <CurrentDirectory condition="is">/etc/plura</CurrentDirectory>
          
					
          <CommandLine condition="begin with">iptables -I INPUT -s</CommandLine>
          
					
          <CommandLine condition="end with">-j LOG --log-prefix [PLURA Defend]</CommandLine>
          
				
        </Rule>
        
			
      </ProcessCreate>
      
		
    </RuleGroup>
    
		
		
		
    <RuleGroup name="Defult_NetworkConnect" groupRelation="or">
      
			
      <NetworkConnect onmatch="exclude">
        
				
        <Image condition="contains">/usr/local/sbin/plurad</Image>
        
				
        <Image condition="is">plurad</Image>
        
				
			
      </NetworkConnect>
      
		
    </RuleGroup>
    
		
		
		
		
		
    <RuleGroup name="Defult_ProcessTerminate" groupRelation="or">
      
			
      <ProcessTerminate onmatch="exclude">
        
				
        <Rule name="PLURA_Execution_Disk Use_dash" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/dash</Image>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Disk Use_df" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/df</Image>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Disk Use_gawk" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gawk</Image>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_Mem Use_free" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/free</Image>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log gzip" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gzip</Image>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log rm" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/rm</Image>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log wc" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/wc</Image>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_log mv" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/mv</Image>
          
				
        </Rule>
        
				
        <Rule name="grep" groupRelation="or">
          
					
          <Image condition="is">/usr/bin/grep</Image>
          
					
          <Image condition="is">/usr/bin/pgrep</Image>
          
				
        </Rule>
        
				
        <Rule name="bash" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/bash</Image>
          
					
          <User condition="is">root</User>
          
				
        </Rule>
        
				
        <Rule name="unknown process" groupRelation="and">
          
					
          <Image condition="contains">unknown process</Image>
          
					
          <User condition="is">-</User>
          
					
          <ProcessGuid condition="is">{00000000-0000-0000-0000-000000000000}</ProcessGuid>
          
				
        </Rule>
         
			
      </ProcessTerminate>
      
		
    </RuleGroup>
    
	
		
		
    <RuleGroup name="Defult_RawAccessRead" groupRelation="or">
      
			
      <RawAccessRead onmatch="exclude"/>
      
		
    </RuleGroup>
    
		
		
		
    <RuleGroup name="Defult_FileCreate" groupRelation="or">
      
			
      <FileCreate onmatch="exclude">
        
				
        <Rule name="PLURA_Execution_event.log" groupRelation="and">
          
					
          <Image condition="is">/usr/local/sbin/plurad</Image>
          
					
          <TargetFilename condition="is">/var/log/plura/agent/event.log</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_event.log" groupRelation="and">
          
					
          <Image condition="is">/usr/local/sbin/plurad</Image>
          
					
          <TargetFilename condition="is">/etc/plura/temp/.sysfilter-ref.json</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_plurad.job" groupRelation="and">
          
					
          <Image condition="is">/usr/local/sbin/plurad</Image>
          
					
          <TargetFilename condition="is">/run/plurad.job</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_event.log.gz" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gzip</Image>
          
					
          <TargetFilename condition="is">/var/log/plura/agent/event.log.gz</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="RSYSLOG_Execution_log" groupRelation="and">
          
					
          <Image condition="is">/usr/sbin/rsyslogd</Image>
          
					
          <TargetFilename condition="is">/var/log/plura/ceelog-127.0.0.1.log</TargetFilename>
          
					
          <User condition="is">syslog</User>
          
				
        </Rule>
        
				
        <Rule name="RSYSLOG_tmp_log" groupRelation="and">
          
					
          <Image condition="is">/usr/sbin/rsyslogd</Image>
          
					
          <TargetFilename condition="is">/etc/plura/temp/.sysfilter-ref.json</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="RSYSLOG_tmp_log" groupRelation="and">
          
					
          <Image condition="is">/usr/sbin/rsyslogd</Image>
          
					
          <TargetFilename condition="is">/var/lib/rsyslog/imjournal.state.tmp</TargetFilename>
          
				
        </Rule>
        
			
      </FileCreate>
      
		
    </RuleGroup>
    
		
		
		
		
    <RuleGroup name="Defult_FileDelete" groupRelation="or">
      
			
      <FileDelete onmatch="exclude">
        
				
        <Rule name="PLURA_Execution_gzip event.log" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gzip</Image>
          
					
          <TargetFilename condition="is">/var/log/plura/agent/event.log</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="PLURA_Execution_gzip event.log.gz" groupRelation="and">
          
					
          <Image condition="is">/usr/bin/gzip</Image>
          
					
          <TargetFilename condition="is">/var/log/plura/agent/event.log</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="RSYSLOG_PLURA_log" groupRelation="and">
          
					
          <Image condition="is">/usr/local/sbin/plurad</Image>
          
					
          <TargetFilename condition="is">/etc/plura/temp/.sysfilter-ref.json</TargetFilename>
          
				
        </Rule>
        
				
        <Rule name="RSYSLOG_rsyslogd_log" groupRelation="and">
          
					
          <Image condition="is">/usr/sbin/rsyslogd</Image>
          
					
          <TargetFilename condition="end with">/var/lib/rsyslog/imjournal.state.tmp</TargetFilename>
          
				
        </Rule>
        
			
      </FileDelete>
      
		
    </RuleGroup>
    

	
    <RuleGroup name="ProcessAccess-Exclude-Legit" groupRelation="or">
      
		
      <ProcessAccess onmatch="exclude">
        
			
        <SourceImage condition="is">C:\Program Files\Windows Defender\MsMpEng.exe</SourceImage>
        
			
        <SourceImage condition="is">C:\Program Files\Microsoft Defender\MsMpEng.exe</SourceImage>
        
			
        <SourceImage condition="is">C:\Windows\System32\Taskmgr.exe</SourceImage>
        
			
        <SourceImage condition="is">C:\Sysinternals\procexp.exe</SourceImage>
        
			
        <SourceImage condition="is">C:\Sysinternals\procmon.exe</SourceImage>
        
			
        <SourceImage condition="end with">\Program Files (x86)\PLURA\PLURAService.exe</SourceImage>
        
			
        <SourceImage condition="end with">\Program Files (x86)\PLURA\PLURASControl.exe</SourceImage>
        
			
        <SourceImage condition="end with">\Program Files (x86)\PLURA\PLURAConfig.exe</SourceImage>
        
			
        <SourceImage condition="end with">\Program Files (x86)\PLURA\PLURATray.exe</SourceImage>
        
			
      </ProcessAccess>
      
		
    </RuleGroup>
    
	
    <RuleGroup name="ProcessAccess-Include-HighSignal" groupRelation="or">
      
		
      <ProcessAccess onmatch="include">
        
			
        <Rule groupRelation="and">
          
				
          <TargetImage condition="end with">\lsass.exe</TargetImage>
          
				
          <Rule groupRelation="or">
            
					
            <SourceImage condition="end with">\powershell.exe</SourceImage>
            
					
            <SourceImage condition="end with">\pwsh.exe</SourceImage>
            
					
            <SourceImage condition="end with">\cmd.exe</SourceImage>
            
					
            <SourceImage condition="end with">\wscript.exe</SourceImage>
            
					
            <SourceImage condition="end with">\cscript.exe</SourceImage>
            
					
            <SourceImage condition="end with">\rundll32.exe</SourceImage>
            
					
            <SourceImage condition="end with">\regsvr32.exe</SourceImage>
            
					
            <SourceImage condition="end with">\mshta.exe</SourceImage>
            
					
            <SourceImage condition="end with">\wmic.exe</SourceImage>
            
					
            <SourceImage condition="end with">\bitsadmin.exe</SourceImage>
            
					
            <SourceImage condition="end with">\certutil.exe</SourceImage>
            
					
            <SourceImage condition="end with">\msbuild.exe</SourceImage>
            
					
            <SourceImage condition="end with">\python.exe</SourceImage>
            
					
            <SourceImage condition="end with">\perl.exe</SourceImage>
            
					
            <SourceImage condition="end with">\ruby.exe</SourceImage>
            
					
            <SourceImage condition="end with">\node.exe</SourceImage>
            
					
            <SourceImage condition="end with">\java.exe</SourceImage>
            
					
            <GrantedAccess condition="contains any">0x1fffff;0x1f3fff;0x1410;0x143a;0x1438;0x1430;0x1010</GrantedAccess>
            
					
          </Rule>
          
				
        </Rule>
        
			
        <Rule groupRelation="and">
          
				
          <TargetImage condition="end with">\winlogon.exe</TargetImage>
          
				
          <GrantedAccess condition="contains any">0x1fffff;0x1f3fff;0x1410;0x143a;0x1438;0x1430</GrantedAccess>
          
				
        </Rule>
        
			
        <Rule groupRelation="and">
          
				
          <TargetImage condition="end with">\lsaiso.exe</TargetImage>
          
				
          <GrantedAccess condition="contains any">0x1fffff;0x1f3fff;0x1410;0x143a;0x1438;0x1430</GrantedAccess>
          
				
        </Rule>
        
			
      </ProcessAccess>
      
		
    </RuleGroup>
    
	
    <RuleGroup name="Include_MalwareDrop_Server" groupRelation="or">
      
      
      <FileExecutableDetected onmatch="include">
        

        
        
        <Rule groupRelation="and">
          
          
          <TargetFilename condition="begin with">C:\Users\</TargetFilename>
          
          
          <TargetFilename condition="contains any">
            \Documents\;
            \Pictures\;
            \Videos\;
            \Music\;
            \Favorites\;
            \Client_Contracts\
          </TargetFilename>
          
        
        </Rule>
        

        
        
        <TargetFilename condition="begin with">C:\Temp\</TargetFilename>
        
        
        <TargetFilename condition="begin with">C:\Windows\Temp\</TargetFilename>
        

        
        
        <Rule groupRelation="and">
          
          
          <Image condition="contains any">
            OUTLOOK.exe;
            WINWORD.exe;
            POWERPNT.exe;
            EXCEL.exe;
            VISIO.exe;
            MSACCESS.exe;
            MSPUB.exe;
            EQNEDT32.exe;
            TEAMS.exe;
            LYNC.exe
          </Image>
          
          
          <TargetFilename condition="contains any">
            \Temp\;
            \AppData\Local\Temp\;
            \AppData\Roaming\
          </TargetFilename>
          
        
        </Rule>
        

        
        
        <Rule groupRelation="and">
          
          
          <Image condition="end with">7z.exe</Image>
          
          
          <TargetFilename condition="contains">\AppData\Local\Temp\</TargetFilename>
          
        
        </Rule>
        

        

      
      </FileExecutableDetected>
      
    
    </RuleGroup>
    

    

    
    
    <RuleGroup name="Include_LOLBAS_FileExecutableDetected_Server_Strict" groupRelation="or">
      
      
      <FileExecutableDetected onmatch="include">
        
        
        <Rule groupRelation="and">
          
          
          <Image condition="contains any">
            AddinUtil.exe;
            AppInstaller.exe;
            Aspnet_Compiler.exe;
            At.exe;
            Atbroker.exe;
            Bash.exe;
            Bitsadmin.exe;
            CertOC.exe;
            CertReq.exe;
            Certutil.exe;
            Change.exe;
            Cipher.exe;
            Cmd.exe;
            Cmdkey.exe;
            Cmstp.exe;
            Colorcpl.exe;
            ComputerDefaults.exe;
            ConfigSecurityPolicy.exe;
            Conhost.exe;
            Control.exe;
            Csc.exe;
            Cscript.exe;
            CustomShellHost.exe;
            DataSvcUtil.exe;
            Desktopimgdownldr.exe;
            DeviceCredentialDeployment.exe;
            Dfsvc.exe;
            Diantz.exe;
            Diskshadow.exe;
            Dnscmd.exe;
            Esentutl.exe;
            Eudcedit.exe;
            Eventvwr.exe;
            Expand.exe;
            Explorer.exe;
            Extexport.exe;
            Extrac32.exe;
            Findstr.exe;
            Finger.exe;
            Forfiles.exe;
            Fsutil.exe;
            Ftp.exe;
            Gpscript.exe;
            Hh.exe;
            IMEWDBLD.exe;
            Ie4uinit.exe;
            Ieexec.exe;
            Ilasm.exe;
            Infdefaultinstall.exe;
            Installutil.exe;
            Jsc.exe;
            Ldifde.exe;
            Makecab.exe;
            Mavinject.exe;
            Microsoft.Workflow.Compiler.exe;
            Mmc.exe;
            MpCmdRun.exe;
            Msbuild.exe;
            Msconfig.exe;
            Msdt.exe;
            Msedge.exe;
            Mshta.exe;
            Msiexec.exe;
            Netsh.exe;
            Ngen.exe;
            Odbcconf.exe;
            OfflineScannerShell.exe;
            OneDriveStandaloneUpdater.exe;
            Pcalua.exe;
            Pcwrun.exe;
            Pktmon.exe;
            Pnputil.exe;
            Presentationhost.exe;
            Print.exe;
            PrintBrm.exe;
            Provlaunch.exe;
            Psr.exe;
            Query.exe;
            Rasautou.exe;
            Reg.exe;
            Regasm.exe;
            Regedit.exe;
            Regini.exe;
            Register-cimprovider.exe;
            Regsvcs.exe;
            Regsvr32.exe;
            Replace.exe;
            Reset.exe;
            Rpcping.exe;
            Rundll32.exe;
            Runexehelper.exe;
            Runonce.exe;
            Runscripthelper.exe;
            Sc.exe;
            Schtasks.exe;
            Scriptrunner.exe;
            Setres.exe;
            SettingSyncHost.exe;
            Sftp.exe;
            Stordiag.exe;
            SyncAppvPublishingServer.exe;
            Tar.exe;
            Ttdinject.exe;
            Tttracer.exe;
            Unregmp2.exe;
            Verclsid.exe;
            Wab.exe;
            Wlrmdr.exe;
            Wmic.exe;
            WorkFolders.exe;
            Wscript.exe;
            Wsreset.exe;
            Xwizard.exe;
            cmdl32.exe;
            fltMC.exe;
            iediagcmd.exe;
            iscsicpl.exe;
            msedge_proxy.exe;
            msedgewebview2.exe;
            rdrleakdiag.exe;
            ssh.exe;
            vbc.exe;
            wbadmin.exe;
            wbemtest.exe;
            winget.exe;
            wt.exe;
            wuauclt.exe;
          </Image>
          
          
          <TargetFilename condition="contains any">
            C:\Users\;
            C:\Users\Public\;
            C:\ProgramData\;
            C:\Windows\Temp\;
            C:\Temp\;
          </TargetFilename>
          
        
        </Rule>
        
      
      </FileExecutableDetected>
      
    
    </RuleGroup>
    

    
    <RuleGroup name="Exclude_LegitActivity_Server" groupRelation="or">
      
      
      <FileExecutableDetected onmatch="exclude">
        

        
        
        <TargetFilename condition="contains">Content.Outlook\</TargetFilename>
        
        
        <TargetFilename condition="contains">Content.MSO\</TargetFilename>
        
        
        <TargetFilename condition="end with">MSForms.exd</TargetFilename>
        
        
        <TargetFilename condition="contains">~$</TargetFilename>
        

        
        
        <Rule groupRelation="and">
          
          
          <TargetFilename condition="begin with">C:\Users\</TargetFilename>
          
          
          <TargetFilename condition="contains">\Downloads\</TargetFilename>
          
        
        </Rule>
        

        
        
        <Rule groupRelation="and">
          
          
          <TargetFilename condition="begin with">C:\Users\</TargetFilename>
          
          
          <TargetFilename condition="contains">\Documents\WindowsPowerShell\</TargetFilename>
          
        
        </Rule>
        

        
        
        <Image condition="is">C:\Windows\System32\msiexec.exe</Image>
        
        
        <Image condition="is">C:\Windows\servicing\TrustedInstaller.exe</Image>
        
        
        <Image condition="is">C:\Windows\System32\TiWorker.exe</Image>
        
        
        <Image condition="is">C:\Windows\System32\dism.exe</Image>
        
        
        <Image condition="is">C:\Windows\System32\wusa.exe</Image>
        
        
        <Image condition="is">C:\Windows\System32\cleanmgr.exe</Image>
        
        
        <Image condition="is">C:\Windows\System32\wuauclt.exe</Image>
        

        
        
        <Image condition="is">C:\Windows\System32\werfault.exe</Image>
        
        
        <Image condition="is">C:\Windows\System32\wermgr.exe</Image>
        

        
        
        <Image condition="is">C:\Windows\System32\makecab.exe</Image>
        
        
        <Image condition="is">C:\Windows\System32\iexpress.exe</Image>
        

        
        
        <Image condition="contains any">
          C:\ProgramData\Microsoft\Windows Defender\Platform\;
          MsMpEng.exe
        </Image>
        
        
        <Image condition="end with">MpSigStub.exe</Image>
        
        
        <Image condition="end with">NisSrv.exe</Image>
        
        
        <Image condition="end with">Sysmon.exe</Image>
        

        
        
        <Image condition="contains">\venv\Scripts\python.exe</Image>
        
        
        <Image condition="contains">\python.exe</Image>
        
        
        <Image condition="contains">\pip.exe</Image>
        

        
        
        <Image condition="contains any">
          msedge.exe;
          Squirrel.exe;
          Update.exe;
          Discord.exe;
          Teams.exe;
          Zoom.exe
        </Image>
        
        
        <Rule groupRelation="and">
          
          
          <Image condition="is">C:\Program Files\Google\Chrome\Application\chrome.exe</Image>
          
        
        </Rule>
        

        
        <Image condition="contains any">
          agent;
          updater;
          backup;
          monitor
        </Image>
        

        
        <Image condition="end with">OneDrive.exe</Image>
        

        
        
        <Rule groupRelation="and">
          
          
          <Image condition="is">C:\Windows\System32\taskhostw.exe</Image>
          
          
          <TargetFilename condition="begin with">C:\Windows\Temp\SDIAG_</TargetFilename>
          
          
          <TargetFilename condition="contains any">.dll;.dll.mui</TargetFilename>
          
        
        </Rule>
        

        
        
        <Rule groupRelation="and">
          
          
          <Image condition="is">C:\Windows\system32\wbem\wmiprvse.exe</Image>
          
          
          <TargetFilename condition="contains">\Windows\Temp\</TargetFilename>
          
        
        </Rule>
        
        
      
      </FileExecutableDetected>
      
    
    </RuleGroup>
    

  
  </EventFiltering>
  

</Sysmon>
